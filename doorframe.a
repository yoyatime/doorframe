
	processor 6502
        include "vcs.h"
        include "macro.h"
        include "xmacro.h"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Constants
TitleScreen 	equ #$00
GameScreen 	equ #$01
EarthColum	equ #$D2
SkyColum	equ #$AA
KongolHeight  	equ #24

; Variables segment

        	seg.u Variables
		org $80

; Title Screen Overlay
Mode		ds 1		;0 = Title Screen
				;1 = Game
                                
; Game Screen Overlay                
                org $80
KongolTablePtr  ds 2   
KongolYPos	ds 1
KongolXPos 	ds 1
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Code segment

	seg Code
        org $f000

Start
	CLEAN_START
        
        
        lda #<KongolG		;Assign P0 sprite pointer 
        sta KongolTablePtr
        lda #>KongolG
        sta KongolTablePtr+1
        
        lda #%101
        sta NUSIZ0
        
        lda #TitleScreen	;Start at Title Screen
        sta Mode		;
        
NextFrame
        lsr SWCHB	; test Game Reset switch
        bcc Start	; reset?
; 1 + 3 lines of VSYNC
	VERTICAL_SYNC
; 36 lines of underscan
	TIMER_SETUP 36
        TIMER_WAIT
        
        
; 192 lines of frame
        
        cmp Mode	 
        bne DrawGameScreenStart

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Title Screen
DrawTitleScreen
	
        ldx #192		;X = scanline number
        ldy #$0			;y = vertical pixel height counter
        lda INPT4		;scan for player 0 input to switch to gameplay logic
	rol 			;player 0 joystick button is high bit of INPT4
        bcs DrawTitleScreenLoop
        lda #GameScreen		;set gamemode to game screen
        sta Mode		;
        
DrawTitleScreenLoop        
        txa
        adc #$FB		;Color Playfield with X + 3
        sta COLUPF
        
        lda PF0Title,y		;Write title screen graphics
        sta PF0			;
        			
        lda PF1Title,y
        sta PF1
        
        lda PF2Title,y
        sta PF2
        
        lda PF3Title,y
        sta PF0
        
        lda PF4Title,y
        sta PF1
        
        lda PF5Title,y
        sta PF2
        
        txa
        and #%00000111		;increment Y every 4th scanline
        cmp #%00000100		;
        bne TitleLineFinish	;
        iny			;
        
TitleLineFinish    
        
        
        sta WSYNC
	dex
        bne DrawTitleScreenLoop
        jmp Overscan



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Game Screen



DrawGameScreenStart
	


	ldy #192		;Y -> scanline number
	ldx #6			;X -> iterations of sky 
        
        
        lda #$60
        ;sta KongolXPos
        sta KongolYPos
        
        lda #$AA 		;set BK sky to blue
        sta COLUBK
        
        lda #$00		;Clear Playfield
        sta PF0
        sta PF1
        sta PF2
        
        
        
        
        
DrawSkyline
	lda #EarthColum		;set PF mountains to green
        sta COLUPF
        
        sta WSYNC		;2 scanlines of sky without mountains
        sta WSYNC		;
        
        
DrawSkylineLoop
        lda PF0Sky,X
        sta PF0
        
        lda PF1Sky,X
        sta PF1
        
        lda PF2Sky,X
        sta PF2
        
        
        sta WSYNC		;2 scanline resolution for mountains
        sta WSYNC
        
        dex
        bne DrawSkylineLoop
        
        lda #$0		
        sta PF0
        sta PF1
        sta PF2
        lda #EarthColum		;set gamescreen BK to green
        sta COLUBK
        ldy #176		;number of scanlines remaining
        

DrawGameScreen
	
        
        ;lda (KongolTablePtr),y
   	;sta GRP0
        
        
        tya				;Start of Skipdraw
        ;sec
        sbc KongolYPos			
        adc KongolHeight
        bcc SkipDraw
        tax
        lda KongolG,x
        
KongolContinue
	sta GRP0
	lda KongolC,x
        sta COLUP0
        dey
        sta WSYNC
        bne DrawGameScreen

        


; 29 lines of overscan
Overscan
	lda #$00
        sta COLUBK	;set over/underscan BG to black
        sta COLUPF	;set over/underscan PF to black
        sta PF0
        sta PF1
        sta PF2

	TIMER_SETUP 29
        TIMER_WAIT
        
; total = 262 lines, go to next frame
        jmp NextFrame
 
 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Skipdraw Bumper

SkipDraw
	lda #0
        beq KongolContinue


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Set horizontal position of Kongol
SetHorizPos
        sta HMCLR
        sta WSYNC       ; start a new line
        sec             ; set carry flag
DivideLoop
        sbc #15         ; subtract 15
        bcs DivideLoop  ; branch until negative
        eor #7          ; calculate fine offset
        asl
        asl
        asl
        asl
        sta HMP0,x      ; set fine offset
        sta RESP0,x     ; fix coarse position
        sta WSYNC
        sta HMOVE
        rts             ; return to caller 


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Graphical Data

;---Sprite Data from PlayerPal 2600---

KongolG
        .byte #%01100110;$06
        .byte #%01100110;$F0
        .byte #%01100110;$F0
        .byte #%00100100;$2C
        .byte #%00100100;$2C
        .byte #%00111100;$F2
        .byte #%00111100;$04
        .byte #%00111100;$2C
        .byte #%00111101;$2C
        .byte #%10111101;$2C
        .byte #%10111101;$F2
        .byte #%10111101;$F2
        .byte #%11111111;$2C
        .byte #%11111111;$2C
        .byte #%11111111;$2C
        .byte #%11111111;$18
        .byte #%00011000;$2C
        .byte #%00011000;$2C
        .byte #%00111100;$2C
        .byte #%00111100;$30
        .byte #%00111100;$2C
        .byte #%00011000;$F0
        .byte #%00011000;$F0
        .byte #%00011000;$F0

KongolC
        .byte #$06;
        .byte #$F0;
        .byte #$F0;
        .byte #$2C;
        .byte #$2C;
        .byte #$F2;
        .byte #$04;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$F2;
        .byte #$F2;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$18;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$30;
        .byte #$2C;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;

AxeG
        .byte #%00000000;$F2
        .byte #%00000000;$F2
        .byte #%10000000;$F2
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F2
        .byte #%11100000;$04
        .byte #%11110000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11110000;$06
        .byte #%11100000;$02
        .byte #%00000000;$F0
        .byte #%00000000;$F0

AxeC
        .byte #$F2;
        .byte #$F2;
        .byte #$F2;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F2;
        .byte #$04;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$02;
        .byte #$F0;
        .byte #$F0;
        
;---End Sprite Data---


;---Begin Game Screen PF Data---

PF0Sky
	.byte %00000000
	.byte %11110000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF1Sky
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %01111111
	.byte %00111111
	.byte %00011110
	.byte %00001100

PF2Sky
	.byte %00000000
	.byte %11111111
	.byte %01110011
	.byte %00100001
	.byte %00000000
	.byte %00000000
	.byte %00000000

;---End Game Screen PF Data---

;---Begin Title Screen PF Data---
PF0Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %10000000
	.byte %10000000
	.byte %10000000
	.byte %10000000
	.byte %00000000
	.byte %00000000
	.byte %11100000
	.byte %01100000
	.byte %10000000
	.byte %11100000
	.byte %00000000
	.byte %00000000
	.byte %10000000
	.byte %10000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF1Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00101111
	.byte %01001001
	.byte %11001001
	.byte %00101111
	.byte %00000000
	.byte %00000000
	.byte %10111101
	.byte %00011001
	.byte %10011001
	.byte %10011001
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF2Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %11010010
	.byte %01010110
	.byte %01011010
	.byte %11010010
	.byte %00000000
	.byte %00000000
	.byte %10010111
	.byte %10010100
	.byte %10010011
	.byte %11110100
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF3Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %10110000
	.byte %10000000
	.byte %10100000
	.byte %10110000
	.byte %00000000
	.byte %00000000
	.byte %11100000
	.byte %00100000
	.byte %00100000
	.byte %11100000
	.byte %00000000
	.byte %00000000
	.byte %11110000
	.byte %11110000
	.byte %00000000
	.byte %10010000
	.byte %11110000
	.byte %11110000
	.byte %11100000
	.byte %11000000
	.byte %00000000

PF4Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %11101000
	.byte %00101000
	.byte %00101000
	.byte %11101111
	.byte %00000000
	.byte %00000000
	.byte %10111101
	.byte %00100001
	.byte %10100101
	.byte %10111101
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %00000000

PF5Title
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00111101
	.byte %00001101
	.byte %00110000
	.byte %00111100
	.byte %00000000
	.byte %00000000
	.byte %11110000
	.byte %00010000
	.byte %00110000
	.byte %11110111
	.byte %00000000
	.byte %00000000
	.byte %00000001
	.byte %00000001
	.byte %00000000
	.byte %00001001
	.byte %00001111
	.byte %00001111
	.byte %00000111
	.byte %00000011
	.byte %00000000

;---End Title Screen PF Data---

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Epilogue
	org $fffc
        .word Start	; reset vector
        .word Start	; BRK vector
