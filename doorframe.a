
	processor 6502
        include "vcs.h"
        include "macro.h"
        include "xmacro.h"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Constants
TitleScreen 	equ #$00
GameScreen 	equ #$01

; Variables segment

        	seg.u Variables
		org $80

; Title Screen Overlay
Mode		ds 1		;0 = Title Screen
				;1 = Game
                                
; Game Screen Overlay                
                org $80
                                
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Code segment

	seg Code
        org $f000

Start
	CLEAN_START
        lda #TitleScreen	; Start at Title Screen
        sta Mode		;
        
NextFrame
        lsr SWCHB	; test Game Reset switch
        bcc Start	; reset?
; 1 + 3 lines of VSYNC
	VERTICAL_SYNC
; 37 lines of underscan
	TIMER_SETUP 37
        TIMER_WAIT
        
; 192 lines of frame
	ldx #$0		;X = scanline number
        ldy #$0		;y = vertical pixel height counter
        
        cmp Mode	 
        bne DrawGameScreen

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Title Screen
DrawTitleScreen
	lda INPT4		;scan for player 0 input to switch to gameplay logic
	rol 			;player 0 joystick button is high bit of INPT4 
        bcs DrawTitleScreenLoop
        lda #GameScreen
        sta Mode		;set gamemode to game
        
DrawTitleScreenLoop        
        txa
        adc #$03		;Color Playfield with X + 3
        sta COLUPF
        
        lda PF0Data,y
        sta PF0
        
        lda PF1Data,y
        sta PF1
        
        lda PF2Data,y
        sta PF2
        
        lda PF3Data,y
        sta PF0
        
        lda PF4Data,y
        sta PF1
        
        lda PF5Data,y
        sta PF2
        
        txa
        and #%00000111		;increment Y every 4th scanline
        cmp #%00000100		;
        bne TitleLineFinish	;
        iny			;
        
TitleLineFinish    
        inx
        cpx #192
        sta WSYNC
        bne DrawTitleScreenLoop
        jmp Overscan



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Game Screen

DrawGameScreen
	lda #$30
        sta COLUBK
        sta WSYNC
        inx
        cpx #192
        bne DrawGameScreen
        


; 29 lines of overscan
Overscan
	lda #$00
        sta COLUBK	;set over/underscan BG to black
        sta COLUPF	;set over/underscan PF to black
	TIMER_SETUP 29
        TIMER_WAIT
; total = 262 lines, go to next frame
        jmp NextFrame
        


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Graphical Data

;---Sprite Data from PlayerPal 2600---

KongolG
        .byte #%01100110;$06
        .byte #%01100110;$F0
        .byte #%01100110;$F0
        .byte #%00100100;$2C
        .byte #%00100100;$2C
        .byte #%00111100;$F2
        .byte #%00111100;$04
        .byte #%00111100;$2C
        .byte #%00111101;$2C
        .byte #%10111101;$2C
        .byte #%10111101;$F2
        .byte #%10111101;$F2
        .byte #%11111111;$2C
        .byte #%11111111;$2C
        .byte #%11111111;$2C
        .byte #%11111111;$18
        .byte #%00011000;$2C
        .byte #%00011000;$2C
        .byte #%00111100;$2C
        .byte #%00111100;$30
        .byte #%00111100;$2C
        .byte #%00011000;$F0
        .byte #%00011000;$F0
        .byte #%00011000;$F0

KongolC
        .byte #$06;
        .byte #$F0;
        .byte #$F0;
        .byte #$2C;
        .byte #$2C;
        .byte #$F2;
        .byte #$04;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$F2;
        .byte #$F2;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$18;
        .byte #$2C;
        .byte #$2C;
        .byte #$2C;
        .byte #$30;
        .byte #$2C;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;

AxeG
        .byte #%00000000;$F2
        .byte #%00000000;$F2
        .byte #%10000000;$F2
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F0
        .byte #%10000000;$F2
        .byte #%11100000;$04
        .byte #%11110000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11111000;$06
        .byte #%11110000;$06
        .byte #%11100000;$02
        .byte #%00000000;$F0
        .byte #%00000000;$F0

AxeC
        .byte #$F2;
        .byte #$F2;
        .byte #$F2;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F0;
        .byte #$F2;
        .byte #$04;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$06;
        .byte #$02;
        .byte #$F0;
        .byte #$F0;
        
;---End Sprite Data---

;---Begin Title Screen PF Data---
PF0Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %10000000
	.byte %10000000
	.byte %10000000
	.byte %10000000
	.byte %00000000
	.byte %00000000
	.byte %11100000
	.byte %01100000
	.byte %10000000
	.byte %11100000
	.byte %00000000
	.byte %00000000
	.byte %10000000
	.byte %10000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF1Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00101111
	.byte %01001001
	.byte %11001001
	.byte %00101111
	.byte %00000000
	.byte %00000000
	.byte %10111101
	.byte %00011001
	.byte %10011001
	.byte %10011001
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF2Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %11010010
	.byte %01010110
	.byte %01011010
	.byte %11010010
	.byte %00000000
	.byte %00000000
	.byte %10010111
	.byte %10010100
	.byte %10010011
	.byte %11110100
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000

PF3Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %10110000
	.byte %10000000
	.byte %10100000
	.byte %10110000
	.byte %00000000
	.byte %00000000
	.byte %11100000
	.byte %00100000
	.byte %00100000
	.byte %11100000
	.byte %00000000
	.byte %00000000
	.byte %11110000
	.byte %11110000
	.byte %00000000
	.byte %10010000
	.byte %11110000
	.byte %11110000
	.byte %11100000
	.byte %11000000
	.byte %00000000

PF4Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %11101000
	.byte %00101000
	.byte %00101000
	.byte %11101111
	.byte %00000000
	.byte %00000000
	.byte %10111101
	.byte %00100001
	.byte %10100101
	.byte %10111101
	.byte %00000000
	.byte %00000000
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %11111111
	.byte %00000000

PF5Data
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00000000
	.byte %00111101
	.byte %00001101
	.byte %00110000
	.byte %00111100
	.byte %00000000
	.byte %00000000
	.byte %11110000
	.byte %00010000
	.byte %00110000
	.byte %11110111
	.byte %00000000
	.byte %00000000
	.byte %00000001
	.byte %00000001
	.byte %00000000
	.byte %00001001
	.byte %00001111
	.byte %00001111
	.byte %00000111
	.byte %00000011
	.byte %00000000

;---End Title Screen PF Data---

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Epilogue
	org $fffc
        .word Start	; reset vector
        .word Start	; BRK vector
